<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title> Amsterdam Air Quality Monitoring </title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.38.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.38.0/mapbox-gl.css' rel='stylesheet' />
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <script src='./data/ams_vondelpark_5-01-2017.js'></script>
    <!-- <script src='./data/aqi_monitoring_network.js'></script>-->
    <script src='./data/ams_stadhouderskade_5-01-2017_test.js'></script>
    <!-- <script src='https://npmcdn.com/@turf/turf/turf.min.js'></script> -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/mapbox-gl/0.35.0/mapbox-gl.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mapbox-gl/0.35.0/mapbox-gl.js"></script>
    
</head>
    
<body>
<div id='map'></div>
    
    <div id='console'>
      <h1>This Week's Air Quality Monitoring</h1>
      <p>Data: <a href='https://www.luchtmeetnet.nl/download'>Pollution Concentrations</a> in Amsterdam, The Netherlands</p>

      <div class='session'>
          <h2><select id="pollutant">
		  <option value="NO" >NO</option>
          <option value="NO2" selected >NO2</option>
       	  </select> Concentration (Î¼g/m3)</h2>
          <div class='row colors'></div>
          <div class='row labels'>
            <div class='label'>0</div>
            <div class='label'>25</div>
            <div class='label'>75</div>
            <div class='label'>100</div>
            <div class='label'>125</div>
            <div class='label'>150+</div>
          </div>
      </div>  

      <div class='session' id='sliderbar'>
          <h2>Hour: <label id='active-hour'>12PM</label></h2>
          <input id='slider' class='row' type='range' min='0' max='23' step='1' value='12' />
      </div>

      <div class='session'>
          <h2>Day of the week</h2>
          <div class='row' id='filters'>
	    <input id='sun' type='radio' name='toggle' value='sun'>
	    <label for='sun'>Sunday</label>
		  <br/>
            <input id='mon' type='radio' name='toggle' value='mon' checked='checked'>
	    <label for='mon'>Monday</label>
		  <br/>
            <input id='tues' type='radio' name='toggle' value='tues'>
            <label for='tues'>Tuesday</label>
		  <br/>
	    <input id='wed' type='radio' name='toggle' value='wed'>
            <label for='wed'>Wednesday</label>
		  <br/>
 	    <input id='thurs' type='radio' name='toggle' value='thurs'>
            <label for='thurs'>Thursday</label>
		  <br/>
	    <input id='fri' type='radio' name='toggle' value='fri'>
            <label for='fri'>Friday</label>
		  <br/>
	    <input id='sat' type='radio' name='toggle' value='sat'>
            <label for='sat'>Saturday</label>
          </div>
      </div>
         
    </div> <!-- end console -->

 <script>  
mapboxgl.accessToken = 'pk.eyJ1IjoiZGhlY2h0IiwiYSI6ImNqNHRueTVyeDA3ZmYyd3FuY2NmYW9tNmoifQ.FetU2-IBDcrhTmSKBpFIfA';
var map = new mapboxgl.Map({
          container: 'map', // container id
          style:  'mapbox://styles/mapbox/streets-v9',    // 'mapbox://styles/dhecht/cj53sifm400tw2smg5jlerack', // stylesheet location
          center: [4.885431, 52.35963], // long lat
          zoom: 11.5 // starting zoom
  

 map.on('style.load', function() {
          map.addSource("points", {
		type: 'geojson',
  		data: './data/aqi_monitoring_network.geojson'
	    //'https://raw.githubusercontent.com/dannyhecht/ams-air-quality/master/data/aqi_monitoring_network.geojson'
   	 });
         
          map.addLayer({
            id: 'points',
            interactive: true, 
            type: 'symbol',
            source: { 
		type:'geojson',
	      	data:'./data/aqi_monitoring_network.geojson'
                     },
            layout: {
              'icon-image': 'marker-12',
              'icon-allow-overlap': true,
              'icon-size': 1.25,
              "text-font": "Open Sans Semibold, Arial Unicode MS Bold",
              "text-offset": [0, 0.6],
              "text-anchor": "top"
            },
            paint: {"text-size": 10 }
          });
    
          map.addLayer({
            id: 'collisions',
            type: 'circle',
            filter: ['==', 'Hour', 12],
            source: {
              type: 'geojson',
              data: test 
            },
            paint: {
              'circle-radius': {
                property: 'Concentration',
                stops: [
                  [0, 3],
                  [5, 15]
                ]
              },
              'circle-color': {
                property: 'Concentration',
                stops: [
                  [0, '#2DC4B2'],
                  [25, '#3BB3C3'],
                  [75, '#669EC4'],
                  [100, '#8B88B6'],
                  [125, '#A2719B'],
                  [150, '#AA5E79']
                ]
              },
              'circle-opacity': 0.8
            }
          }, 'admin-2-boundaries-dispute'); // place the layer beneath this layer in the basemap
       
            

    });

     document.getElementById('slider').addEventListener('input', function(e) {
              // get the current hour as an integer
              var hour = parseInt(e.target.value);
              // map.setFilter(layer-name, filter)
              map.setFilter('collisions', ['==', 'Hour', hour]);

              // converting 0-23 hour to AMPM format
              var ampm = hour >= 12 ? 'PM' : 'AM';
              var hour12 = hour % 12 ? hour % 12 : 12;
              // update text in the UI
              document.getElementById('active-hour').innerText = hour12 + ampm;
         });

        document.getElementById('filters').addEventListener('change', function(e) {
              var day = e.target.value;
              var filterDay;
              if (day === 'sun') {
                filterDay = ['==', 'Day','Sun'];
              } else if (day === 'mon') {
                filterDay = ['==', 'Day', 'Mon'];
              } else if (day === 'tues') {
                filterDay = ['==', 'Day', 'Tues'];
              } else if (day === 'wed') {
                filterDay = ['==', 'Day', 'Wed'];
              } else if (day === 'thurs') {
                filterDay = ['==', 'Day', 'Thurs'];
              } else if (day === 'fri') {
                filterDay = ['==', 'Day', 'Fri'];
	      } else if (day === 'sat') {
                filterDay = ['==', 'Day', 'Mon'];
              } else {
                console.log('error');
              }
              map.setFilter('collisions', filterDay);
        }); 
        
    // stations marker popup    
 map.on('click', function (e) {
    // Use featuresAt to get features within a given radius of the click event
    // Use layer option to avoid getting results from other layers
        map.featuresAt(e.point, {layer: 'points', radius: 10, includeGeometry: true}, function (err, features) {
            if (err) throw err;
            // if there are features within the given radius of the click event,
            // fly to the location of the click event
            if (features.length) {
                // Get coordinates from the symbol and center the map on those coordinates
                map.flyTo({center: features[0].geometry.coordinates});
                var featureStation = features[0].properties.Station;
                var featureDescription = features[0].properties.des;
                var tooltip = new mapboxgl.Popup()
                    .setLngLat(e.lngLat)
                    .setHTML('<p>' + featureStation + featureDescription + '</p>')
                    .addTo(map);
                }
            });
        }); 
        
    // Use the same approach as above to indicate that the symbols are clickable
    // by changing the cursor style to 'pointer'.
 map.on('mousemove', function (e) {
        map.featuresAt(e.point, {layer: 'points', radius: 10}, function (err, features) {
            if (err) throw err;
            map.getCanvas().style.cursor = features.length ? 'pointer' : '';
            });
        });
        
</script>       
<!-- <script src='js/timeFilters.js'></script> -->
<script src='js/geolocate.js'></script>
</body>    
</html>
