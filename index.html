<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title> Air Quality Monitoring </title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <!-- <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.39.1/mapbox-gl.js'></script> -->
    <!-- <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.39.1/mapbox-gl.css' rel='stylesheet' /> -->
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.38.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.38.0/mapbox-gl.css' rel='stylesheet' />
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <script src='https://npmcdn.com/@turf/turf/turf.min.js'></script>


    
</head>
    
<body>
<div id='map'></div>


    <div id='console'>
      <h1>Hourly Air Pollution Levels</h1>
      <p>Data: <a href='https://www.luchtmeetnet.nl/download'>Pollution Concentrations</a> in Amsterdam, The Netherlands</p>

      <div class='session'>
          <h2>NO2 Concentration (Î¼g/m3)</h2>
          <div class='row colors'></div>
          <div class='row labels'>
            <div class='label'>0</div>
            <div class='label'>25</div>
            <div class='label'>75</div>
            <div class='label'>100</div>
            <div class='label'>125</div>
            <div class='label'>150+</div>
          </div>
      </div>  

      <div class='session' id='sliderbar'>
          <h2>Hour: <label id='active-hour'>12PM</label></h2>
          <input id='slider' class='row' type='range' min='0' max='23' step='1' value='12' />
      </div>

      <div class='session'>
          <h2>Day of the week</h2>
          <div class='row' id='filters'>
            <input id='all' type='radio' name='toggle' value='all' checked='checked'>
            <label for='all'>All</label>
            <input id='weekday' type='radio' name='toggle' value='weekday'>
            <label for='weekday'>Weekday</label>
            <input id='weekend' type='radio' name='toggle' value='weekend'>
            <label for='weekend'>Weekend</label>
          </div>
      </div>

      <!-- <div class='session'>
          <h2>Pollutant</h2>
          <input id='dropdown' class=   -->   
    </div> <!-- end console -->

    
    <script>
    var stations1 = {
       "type": "FeatureCollection",
       "features": [
      {
        "type": "Feature",
        "geometry": {
           "type": "Point",
           "coordinates":  [ 4.904584,52.372234 ]
        },
        "properties": {
        "Station":"Amsterdam-Oude-Schans",
        "type":"City Background"
        }
      },
      {
        "type": "Feature",
        "geometry": {
           "type": "Point",
           "coordinates":  [ 4.899696,52.358080 ]
        },
        "properties": {
        "Station":"Amsterdam-Stadhouderskade",
        "type":"Street Traffic"
        }
      },
      {
        "type": "Feature",
        "geometry": {
           "type": "Point",
           "coordinates":  [ 4.866185,52.359864 ]
        },
        "properties": {
        "Station":"Amsterdam-Vondelpark",
        "type":"City Background"
        }
      },
      {
        "type": "Feature",
        "geometry": {
           "type": "Point",
           "coordinates":  [ 4.860299,52.374851 ]
        },
        "properties": {
        "Station":"Amsterdam-Jan van Galenstraat",
        "type":"Street Traffic"
        }
      },
      {
        "type": "Feature",
        "geometry": {
           "type": "Point",
           "coordinates":  [ 4.875582,52.385449 ]
        },
        "properties": {
        "Station":"Amsterdam-Haarlemmerweg",
        "type":"Street Traffic"
        }
      },
      {
        "type": "Feature",
        "geometry": {
           "type": "Point",
           "coordinates":  [ 4.887904,52.390060 ]
        },
        "properties": {
        "Station":"Amsterdam-Van Diemenstraat",
        "type":"Street Traffic"
        }
      },
      {
        "type": "Feature",
        "geometry": {
           "type": "Point",
           "coordinates":  [ 4.870355,52.394126 ]
        },
        "properties": {
        "Station":"Amsterdam-Westerpark",
        "type":"City Background"
        }
      },
      {
        "type": "Feature",
        "geometry": {
           "type": "Point",
           "coordinates":  [ 4.845117,52.381797 ]
        },
        "properties": {
        "Station":"Amsterdam-Einsteinweg",
        "type":"Street Traffic"
        }
      },
      {
        "type": "Feature",
        "geometry": {
           "type": "Point",
           "coordinates":  [ 4.841014,52.339669 ]
        },
        "properties": {
        "Station":"Amsterdam-A10-West",
        "type":"Street Traffic"
        }
      },
      {
        "type": "Feature",
        "geometry": {
           "type": "Point",
           "coordinates":  [ 4.793309,52.367053 ]
        },
        "properties": {
        "Station":"Amsterdam-Ookmeer",
        "type":"City Background"
        }
      },
      {
        "type": "Feature",
        "geometry": {
           "type": "Point",
           "coordinates":  [ 4.943648,52.389628 ]
        },
        "properties": {
        "Station":"Amsterdam-Nieuwendammerdijk",
        "type":"City Background"
        }
      },
      {
        "type": "Feature",
        "geometry": {
           "type": "Point",
           "coordinates":  [ 4.988346,52.320776 ]
        },
        "properties": {
        "Station":"Amsterdam -Kantershof",
        "type":"City Background"
        }
      }
    ]
    };
        
    mapboxgl.accessToken = 'pk.eyJ1IjoiZGhlY2h0IiwiYSI6ImNqNHRueTVyeDA3ZmYyd3FuY2NmYW9tNmoifQ.FetU2-IBDcrhTmSKBpFIfA';
    var map = new mapboxgl.Map({
          container: 'map', // container id
          style:  'mapbox://styles/dhecht/cj53sifm400tw2smg5jlerack', // stylesheet location
          center: [4.899431, 52.379189], // long lat
          zoom: 11.8 // starting zoom
    });
 
    
    map.on('load', function() {
          map.addLayer({
            id: 'points',
            type: 'symbol',
            source: {  type: 'geojson',
                       data:  stations1
                     },
            layout: {
              'icon-image': 'marker-15'
            },
            paint: { }
          });
        
          map.addLayer({
            id: 'collisions',
            type: 'circle',
            filter: ['==', 'Hour', 12],
            source: {
              type: 'geojson',
              data: 'data/ams_vondelpark_5-01-2017.geojson' 
            },
            paint: {
              'circle-radius': {
                property: 'Concentration',
                stops: [
                  [0, 3],
                  [15, 15]
                ]
              },
              'circle-color': {
                property: 'Concentration',
                stops: [
                  [0, '#2DC4B2'],
                  [25, '#3BB3C3'],
                  [75, '#669EC4'],
                  [100, '#8B88B6'],
                  [125, '#A2719B'],
                  [150, '#AA5E79']
                ]
              },
              'circle-opacity': 0.8
            }
          }, 'admin-2-boundaries-dispute'); // place the layer beneath this layer in the basemap
        });

        document.getElementById('slider').addEventListener('input', function(e) {
          // get the current hour as an integer
          var hour = parseInt(e.target.value);
          // map.setFilter(layer-name, filter)
          map.setFilter('collisions', ['==', 'Hour', hour]);

          // converting 0-23 hour to AMPM format
          var ampm = hour >= 12 ? 'PM' : 'AM';
          var hour12 = hour % 12 ? hour % 12 : 12;
          // update text in the UI
          document.getElementById('active-hour').innerText = hour12 + ampm;
        });

        document.getElementById('filters').addEventListener('change', function(e) {
          var day = e.target.value;
          var filterDay;
          if (day === 'all') {
            filterDay = null;
          } else if (day === 'weekday') {
            filterDay = ['!in', 'Day', 'Sat', 'Sun'];
          } else if (day === 'weekend') {
            filterDay = ['in', 'Day', 'Sat', 'Sun'];
          } else {
            console.log('error');
          }
          map.setFilter('collisions', filterDay);
        });    

    // stations popup info    
    var popup = new mapboxgl.Popup();

    map.on('mousemove', function(e) {
      var features = map.queryRenderedFeatures(e.point, { layers: stations1 });
      if (!features.length) {
        popup.remove();
        return;
      }
      var feature = features[0];

      popup.setLngLat(feature.geometry.coordinates)
      .setHTML(feature.properties.Station)
      .setHTML(feature.properties.type)
      .addTo(map);

      map.getCanvas().style.cursor = features.length ? 'pointer' : '';
    });
     
</script>       
<!-- <script src='js/stationMarkers.js'></script> -->
<!-- <script src='js/timeFilters.js'></script> -->
<script src='js/geolocate.js'></script>
</body>    
</html>
